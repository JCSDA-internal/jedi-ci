name: 'CI Job Launcher'
description: 'Launch a JEDI-CI job'
author: 'JCSDA'

inputs:
  container_version:
    description: 'Container version (latest, next)'
    required: true
    default: 'latest'
  target_project_name:
    description: 'Name build bundle project for this repository (if different from the repo name).'
    required: false
    default: ''
  jedi_ci_token:
    description: 'GitHub token associated with the JEDI CI GitHub app'
    required: false
    default: ''
  test_script:
    description: 'Test script to run (must be in //jedi-ci/shell/)'
    required: false
    default: 'run_tests.sh'
  target_repo_dir:
    description: 'Target repository directory'
    required: false
    default: 'target_repository'
  bundle_repository:
    description: 'Repository to use when cloning the bundle.'
    required: false
    default: 'https://github.com/JCSDA-internal/jedi-bundle.git'
  bundle_branch:
    description: 'Default branch to use when cloning the bundle.'
    required: false
    default: 'develop'
  unittest_tag:
    description: 'CMake tag used to execute unit tests.'
    required: false
    default: ''
  unittest_dependencies:
    description: 'List of bundle items to use as unittest dependencies (must be used with test_script="run_tests.sh").'
    required: false
    default: ''
  simple_bundle_dependencies:
    description: 'List of bundle items to build unit tests and integration tests (must be used with test_script="run_tests_simple.sh").'
    required: false
    default: ''
  self_test:
    description: 'Whether to run a self-test of the JEDI CI action.'
    required: false
    default: 'false'

# GITHUB_TOKEN: ${{ inputs.github_token }}
runs:
  using: 'docker'
  image: 'Dockerfile'
  env:
    UNITTEST_TAG: ${{ inputs.unittest_tag }}
    CONTAINER_VERSION: ${{ inputs.container_version }}
    TARGET_PROJECT_NAME: ${{ inputs.target_project_name }}
    BUNDLE_BRANCH: ${{ inputs.bundle_branch }}
    TEST_SCRIPT: ${{ inputs.test_script }}
    TARGET_REPO_DIR: ${{ inputs.target_repo_dir }}
    BUNDLE_REPOSITORY: ${{ inputs.bundle_repository }}
    CI_SELF_TEST: ${{ inputs.self_test }}
    UNITTEST_BUNDLE_DEPENDENCIES: ${{ inputs.unittest_dependencies }}
    JEDI_CI_TOKEN: ${{ inputs.jedi_ci_token }}
    SIMPLE_BUNDLE_DEPENDENCIES: ${{ inputs.SIMPLE_BUNDLE_DEPENDENCIES }}

branding:
  icon: 'play'
  color: 'blue'
